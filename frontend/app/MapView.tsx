"use client";
// ‡∏ö‡∏≠‡∏Å Next.js ‡∏ß‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô‡∏ù‡∏±‡πà‡∏á Browser (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ù‡∏±‡πà‡∏á Server)
// ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Leaflet ‡πÉ‡∏ä‡πâ window / document ‡∏ã‡∏∂‡πà‡∏á Server ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ

// ‡∏ô‡∏≥ component ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏à‡∏≤‡∏Å react-leaflet
// MapContainer = ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
// TileLayer = ‡∏ä‡∏±‡πâ‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á)
// Marker = ‡∏´‡∏°‡∏∏‡∏î‡∏õ‡∏±‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
import { MapContainer, TileLayer, Marker } from "react-leaflet";

// ‡∏ô‡∏≥ Icon ‡∏°‡∏≤‡∏à‡∏≤‡∏Å leaflet ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏π‡∏õ‡∏´‡∏°‡∏∏‡∏î‡πÄ‡∏≠‡∏á
import { Icon } from "leaflet";

// ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Props) ‡∏ó‡∏µ‡πà component ‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
// lat = ‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î (‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á)
// lon = ‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î (‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô)
type Props = {
  lat: number;
  lon: number;
};

// ‡∏™‡∏£‡πâ‡∏≤‡∏á component ‡∏ä‡∏∑‡πà‡∏≠ MapView
// ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ lat ‡πÅ‡∏•‡∏∞ lon ‡∏°‡∏≤‡∏à‡∏≤‡∏Å component ‡πÅ‡∏°‡πà
export default function MapView({ lat, lon }: Props) {

  // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ GPS ‚Üí ‡πÑ‡∏°‡πà render ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (‡∏Å‡∏±‡∏ô Leaflet ‡∏û‡∏±‡∏á)
  if (lat == null || lon == null) {
    return (
      <div className="map-placeholder">
        üìç ‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• GPS
      </div>
    );
  }



  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏´‡∏°‡∏∏‡∏î (Marker Icon)
  // ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Leaflet ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå public 
  const markerIcon = new Icon({
    iconUrl: "/leaflet/marker-icon.png",        // ‡∏£‡∏π‡∏õ‡∏´‡∏°‡∏∏‡∏î‡∏õ‡∏Å‡∏ï‡∏¥
    iconRetinaUrl: "/leaflet/marker-icon-2x.png", // ‡∏£‡∏π‡∏õ‡∏´‡∏°‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏π‡∏á
    shadowUrl: "/leaflet/marker-shadow.png",    // ‡πÄ‡∏á‡∏≤‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏∏‡∏î

    iconSize: [25, 41],        // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏∏‡∏î (‡∏Å‡∏ß‡πâ‡∏≤‡∏á, ‡∏™‡∏π‡∏á)
    iconAnchor: [12, 41],      // ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏à‡∏£‡∏¥‡∏á (‡∏õ‡∏•‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏á)
    popupAnchor: [1, -34],     // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á popup (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
    shadowSize: [41, 41],      // ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏á‡∏≤
  });

  // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
  return (
    // MapContainer ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    <MapContainer
      center={[lat, lon]}   // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (‡πÉ‡∏ä‡πâ lat, lon)
      zoom={18}             // ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ã‡∏π‡∏° (‡∏¢‡∏¥‡πà‡∏á‡∏°‡∏≤‡∏Å ‡∏¢‡∏¥‡πà‡∏á‡πÉ‡∏Å‡∏•‡πâ)
      className="map"       // class ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢ CSS
    >

      {/* TileLayer ‡∏Ñ‡∏∑‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà */}
      {/* ‡πÉ‡∏ä‡πâ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ü‡∏£‡∏µ‡∏à‡∏≤‡∏Å OpenStreetMap */}
      <TileLayer
        url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
      />

      {/* Marker ‡∏Ñ‡∏∑‡∏≠‡∏´‡∏°‡∏∏‡∏î‡∏õ‡∏±‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á */}
      {/* position ‡πÉ‡∏ä‡πâ lat, lon ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö center */}
      <Marker
        position={[lat, lon]}
        icon={markerIcon}   // ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏´‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á
      />

    </MapContainer>
  );
}
